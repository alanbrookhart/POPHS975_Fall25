---
title: "Creating a Table 1 with the TableOne package"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library("devtools")
devtools::install_github("alanbrookhart/NAMCS")
library(NAMCS)
library(tableone)
library(survey)
library(knitr)
library(DT)
```

## Cohort: new users of Cox-2 inhibitors versus Non-selective NSAID in the National Ambulatory Medical Care Data Survey

We have built a cohort from the 2005-2009 public use files from National Ambulatory Medical Care Data Survey (NAMCS).  The NAMCS survey covers over 20,000 visits per year and includes data on patient demographics, comorbidities, physician and practice characteristics, and treatment received, including medications. Currently, medications are classified using the Multum Lexicon. 

From these data, we identified new users of either NSAID or Cox-2 selective non-steroidal anti-inflammatory drugs (NSAIDs). The data were augmented with a simulated peptic ulcer disease outcome. Variables were selected for this extract based on relevance to the example analyses and on availability for most or all of the 2005-2009 time range.

## Viewing the data

It is always important to review new data.  In the $\tt{NAMCS}$ package, the data frame is named $\tt{ns}$. To browse the data, we pipe the data frame $\tt{ns}$ into the $\tt{datatable}$ function, which creates an interactive viewer in the output.

```{r, eval = FALSE}
ns %>% datatable()
```


## Create a simple Table 1

To understand the characteristics of each treatment group, we create a table 1 summarizing variables by treatment group.  Variables with an SMD > 0.1 are customarily considered to be out of balance.  The table suggest that the Cox-2 selective NSAID initiators are older and have a higher burden of comorbid conditions that the patients starting non-selective NSAIDs.

```{r}
factor_vars = c("year", "region", "arthritis", "asthma", "cancer", "cerebrovascular_disease", "chronic_kidney_disease", "heart_failure", "chronic_pulmonary_disease", "depression", "diabetes", "hyperlipidemia", "hypertension", "coronory_artery_disease", "osteoporosis",  "anti_hypertensive_use", "statin_use", "h2_antagonist_use", "ppi_use", "aspirin_use", "anti_coagulant_use", "corticosteroid_use", "sex", "race", "incident_pud")

table1 = CreateTableOne(data = ns, vars = c("age", factor_vars), factorVars = factor_vars, 
                        strata = "cox2_initiation", test = FALSE, smd = TRUE) 

print(table1, smd = TRUE, printToggle = FALSE) %>% kable()
```

